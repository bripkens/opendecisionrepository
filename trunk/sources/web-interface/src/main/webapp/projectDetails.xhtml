<?xml version='1.0' encoding='UTF-8' ?>
<ui:composition template="template.xhtml" xmlns="http://www.w3.org/1999/xhtml"
                xmlns:ui="http://java.sun.com/jsf/facelets"
                xmlns:h="http://java.sun.com/jsf/html"
                xmlns:f="http://java.sun.com/jsf/core"
                xmlns:ice="http://www.icesoft.com/icefaces/component"
                xmlns:odr="http://www.decisionrepository.com/taglib">

    <ui:define name="head">
    </ui:define>

    <ui:define name="pagetitle">
        <ice:outputText value="#{page['projectDetails.page.title']}" nospan="true" />
        <ice:outputText value="#{projectDetailsController.projectName}" rendered="#{projectDetailsController.valid}" nospan="true"/>
    </ui:define>

    <ui:define name="bodyBegin">
        <div id="deleteConfirmationPopup" class="modalPopup">
            <h1>Delete iteration</h1>

            <p class="deleteConfirmationMessage">
            <ice:outputText value="#{form['iteration.delete.confirmation']}" nospan="true"/>
            <ice:outputText value="#{projectDetailsController.iterationToDeleteName}" />?
            </p>
            <ice:form rendered="#{projectDetailsController.valid}" id="confitmIterationDeleteForm">

                <ice:commandButton action="#{projectDetailsController.deleteIteration}"
                                   value="#{form['button.delete']}"
                                   styleClass="abort"
                                   id="confirmIterationDeleteButton"/>

                <ice:commandButton value="#{form['button.cancel']}" styleClass="hideModalPopupLink"/>
            </ice:form>
        </div>
    </ui:define>

    <ui:define name="content">
        <f:subview rendered="#{projectDetailsController.valid}" id="contentSubView">
            <h1><h:outputText value="#{projectDetailsController.projectName}" /></h1>

            <p><h:outputText value="#{projectDetailsController.description}" /></p>
        </f:subview>
        <ice:form styleClass="members" partialSubmit="true">

            <ice:inputHidden value="#{projectDetailsController.projectId}" />

            <div class="relative">
                <h3>#{page['projectDetails.members']}</h3> <a href="#" class="togglelink collapsable" name="memberContainer1" style="position: absolute; top:0;right:0;">#{common.toggle}</a>
                <div id="memberContainer1" class="toggleContainer" >
                    <ice:dataTable rendered="#{projectDetailsController.valid}"
                                   value="#{projectDetailsController.projectMembers}" var="item" styleClass="rowhover pointer ">
                        <ice:column>
                            <ice:rowSelector
                                selectionListener="#{projectDetailsController.rowMemberSelectionListener}"/>
                            <ice:outputText value="#{item.person.name}" nospan="true"/>
                            <span>&lt;<ice:outputText value="#{item.person.email}" nospan="true"/>&gt;</span>
                        </ice:column>
                        <ice:column>
                            <ice:outputText value="#{item.role.name}" nospan="true"/>
                        </ice:column>
                    </ice:dataTable>
                </div>
            </div>

        </ice:form>



        <div class="relative">
            <h3>#{page['projectDetails.iterations.headline']}</h3> <a href="#" class="togglelink collapsable" name="iterationContainer" style="position: absolute; top:0;right:0;">#{common.toggle}</a>


            <div id="iterationContainer" class="toggleContainer" >

                <a href="#" class="addIterationLink togglelink" name="iterationFormAddContainer">
                    <img src="./resources/images/add.png" width="12" height="12" alt="#{common.add}" />
                    <ice:outputText value="#{page['projectDetails.iterations.add']}"/>
                </a>

                <ice:form partialSubmit="true" id="iterationFormAddContainer">

                    <ice:inputHidden value="#{projectDetailsController.projectId}" />

                    <h3><ice:outputText value="#{form['iteration.new']}" nospan="true" /></h3>


                    <div class="formSection">
                        <ice:outputLabel value="#{form['label.name']}" for="inIterationName"/>
                        <ice:outputText value="#{form['constraint.required']}" styleClass="required" />
                        <ice:inputText id="inIterationName"
                                       label="#{form['label.name']}"
                                       required="true"
                                       value="#{projectDetailsController.iterationName}">
                            <f:validateLength minimum="3" maximum="50" />

                            <f:validator validatorId="RegexValidator" />
                            <f:attribute name="inputCharset" value="A-Za-z0-9-_ " />
                        </ice:inputText>
                        <p>
                        <ice:outputText value="#{form['constraint.minlength']}" nospan="true" /> 3;
                        <ice:outputText value="#{form['constraint.maxlength']}" nospan="true" /> 50;
                        <ice:outputText value="#{form['constraint.charset']}" nospan="true" /> [A-Za-z0-9-_ ];
                        <ice:outputText value="#{form['constraint.iterationname']}" nospan="true" />
                        </p>
                    </div>




                    <div class="formSection last">
                        <ice:outputLabel value="#{form['label.description']}" for="inIterationDescription"/>
                        <ice:inputTextarea id="inIterationDescription"
                                           label="#{form['label.description']}"
                                           maxlength="1000"
                                           value="#{projectDetailsController.iterationDescription}">
                            <f:validateLength maximum="1000" />
                        </ice:inputTextarea>
                        <p><ice:outputText value="#{form['constraint.maxlength']}" nospan="true" /> 1000</p>
                    </div>



                    <ice:commandButton action="#{projectDetailsController.addIteration}"
                                       value="#{form['button.submit']}"
                                       styleClass="confirm"
                                       id="iterationAddSubmitButton"/>



                    <ice:commandButton actionListener="#{projectDetailsController.iterationAddCanceled}"
                                       value="#{form['button.cancel']}"
                                       styleClass="abort togglelink"
                                       id="iterationAddAbortButton"/>
                </ice:form>

                <ice:messages layout="list"
                              errorClass="error"
                              warnClass="warning"
                              fatalClass="fatal"
                              infoClass="information" />

                <a class="modalPopupLink" name="deleteConfirmationPopup">open it!</a>



                <ice:form>

                    <ice:inputHidden value="#{projectDetailsController.projectId}" />

                    <ice:dataTable value="#{projectDetailsController.iterations}" var="item" styleClass="rowhover pointer ">

                        <ice:column>
                            <ice:rowSelector id="selected"
                                             selectionListener="#{projectDetailsController.rowIterationSelectionListener}"/>

                            <ice:outputText value="#{item.name}" styleClass="iterationName" />
                            <ice:outputText value="#{item.id}" styleClass="iterationId" visible="false" />
                        </ice:column>

                        <ice:column>
                            <ice:outputText value="#{item.durationInDays}" nospan="true"/> <ice:outputText value="#{page['projectDetails.iterations.duration']}" nospan="true"/>
                        </ice:column>

                        <ice:column>
                            <f:facet name="header" />
                            <ice:commandLink value=""
                                             styleClass="iterationDeleteButton">
                                <img alt="#{form['iteration.delete']}"
                                     src="resources/images/removeSmall.png"
                                     width="11"
                                     height="11"/>
                                <f:attribute value="#{item}" name="iteration" />

                            </ice:commandLink>
                        </ice:column>

                    </ice:dataTable>

                </ice:form>
            </div>
        </div>



        <f:subview rendered="#{projectDetailsController.valid}" id="actionSubView">
            <h3><ice:outputText value="#{page['projectDetails.actions.headline']}" nospan="true"/></h3>

            <a href="#{projectDetailsController.updateLink}" id="updateLink" title="#{page['projectDetails.actions.edit.title']}" style="text-decoration: none;">
                <img alt="#{common.edit}" src="./resources/images/pencil.png" width="48" height="48" />
            </a>
            <a href="#{projectDetailsController.deleteLink}" style="margin-left: 20px;text-decoration: none;" id="deleteLink" title="#{page['projectDetails.actions.delete.title']}">
                <img alt="#{common.remove}" src="./resources/images/cross.png" width="48" height="48" />
            </a>
        </f:subview>
    </ui:define>

    <!--SIDEBAR-->
    <ui:define name="sidebar">
        <div id="help">
            <ul class="info">
                <li>
                    <div class="header">
                        <img src="resources/images/info.png" alt="information" />
                    </div>
                    <div class="text">
                        <h2><ice:outputText value="#{page['projectDetails.help.title']}" /></h2>
                        <ice:outputText value="#{page['projectDetails.help.text']}" />
                    </div>

                </li>

            </ul>
        </div>

    </ui:define>
</ui:composition>