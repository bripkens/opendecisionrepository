<?xml version='1.0' encoding='UTF-8' ?>
<ui:composition template="template-without-sidebar.xhtml" xmlns="http://www.w3.org/1999/xhtml"
                xmlns:ui="http://java.sun.com/jsf/facelets"
                xmlns:h="http://java.sun.com/jsf/html"
                xmlns:f="http://java.sun.com/jsf/core"
                xmlns:ice="http://www.icesoft.com/icefaces/component"
                xmlns:odr="http://java.sun.com/jsf/composite/odr"
                xmlns:c="http://java.sun.com/jsp/jstl/core">

    <ui:define name="head">
        <script type="text/javascript" src="resources/js/searchableTable.js"></script>
        <link rel="stylesheet" type="text/css" href="resources/css/vtip.min.css" />
        <script type="text/javascript" src="resources/js/vtip-min.js"></script>
    </ui:define>

    <ui:define name="pagetitle">
        <ice:outputText value="#{page['concern.page.title']}" nospan="true" />
    </ui:define>

    <ui:define name="bodyBegin">
        <div id="deleteVersionConfirmationPopup" class="modalPopup deleteConfirmationPopup">
            <h1><ice:outputText value="#{page['projectDetails.concern.delete']}" nospan="true" /></h1>

            <p class="deleteConfirmationMessage">
            <ice:outputText value="#{form['version.delete.confirmation']}" nospan="true"/>
            <ice:outputText value=" #{decisionTableController.versionToDelete.decision.name} (#{decisionTableController.versionToDelete.state.statusName})" />?
            </p>
            <ice:form rendered="#{decisionTableController.valid}" id="confitmConcernDeleteForm">

                <ice:commandButton action="#{decisionTableController.deleteVersion}"
                                   value="#{form['button.delete']}"
                                   styleClass="abort"
                                   id="confirmConcernDeleteButton"/>

                <ice:commandButton value="#{form['button.cancel']}" styleClass="hideModalPopupLink" immediate="true"/>
            </ice:form>
        </div>
    </ui:define>

    <ui:define name="content">
        <odr:breadcrumb breadCrumbSource="#{concernTableController1.navigationBar}" />
        <h1><h:outputText value="Decision Table"/></h1>
        <a href="#{decisionTableController.createDecisionLink}" ><img class="createConcernSymbol vtip" title="create a new decision" src="resources/images/add.png" alt="create"/></a>

        <form>
            <label for="searchInput" class="prefillValue" style="display: none">Search</label>
            <ice:inputText id="searchInput" onkeyup="doFilter(this, 'concernList')" style="width: 200px;" styleClass="prefill"/>
        </form>

        <ice:form partialSubmit="true">
            <table class="dataList" id="concernList">
                <thead>
                    <tr>
                        <th style="width: 5%;"></th>
                        <th style="width: 23%;">Name</th>
                        <th style="width: 15%;">State</th>
                        <th style="width: 20%;">Date</th>
                        <th style="width: 37%;">Initiators</th>
                        <th colspan="3" style="">Actions</th>
                    </tr>
                </thead>
                <tbody>
                <ui:repeat value="#{decisionTableController.list}" var="item" id="concernRepeat">
                    <tr class="parentRow group-#{item.decision.id}">
                        <td style="border-bottom: none">
                            <a class="toggleSubTableShow toggleSubTable" href="#" style="display: none"/>
                        </td>
                        <td title="#{item.decision.name}" class="vtip"><ice:outputText value="#{item.decisionName}" nospan="true" >
                        <f:convertDateTime type="date" pattern="#{common['format.date.time']}" timeZone="#{timeZoneController.timeZone}" />
                    </ice:outputText></td>
                    <td>#{item.currentVersion.state.statusName}</td>
                    <td><ice:outputText value="#{item.currentVersion.documentedWhen}" nospan="true">
                        <f:convertDateTime type="date" pattern="#{common['format.date.time']}" timeZone="#{timeZoneController.timeZone}" />
                    </ice:outputText></td>
                    <td title="#{item.getAllInitiators(item.currentVersion)}" class="vtip">#{item.getInitiators(item.currentVersion)}</td>
                    <td><a href="#{decisionTableController.getShowLink(item.currentVersion)}" ><img class="vtip" title="details" alt="#{common.read}"
                                                                                                    src="resources/images/inspect.png"
                                                                                                    width="14"
                                                                                                    height="14"/></a></td>
                    <td><a href="#{decisionTableController.getUpdateLink(item.currentVersion)}" ><img class="vtip" title="edit" alt="#{common.edit}"
                                                                                                      src="resources/images/pencilSmall.png"
                                                                                                      width="14"
                                                                                                      height="14"/></a></td>
                    <td><ice:commandLink value=""
                                         actionListener="#{decisionTableController.showDeleteVersionConfirmation}"
                                         styleClass="columnNavigationLink">
                        <img alt="#{common.remove}"
                             src="resources/images/removeSmall.png"
                             width="14"
                             height="14"/>
                        <f:attribute value="#{item.currentVersion}" name="version" />

                    </ice:commandLink></td>
                    </tr>
                    <ui:repeat value="#{item.subVersions}" var="version" id="subconcernRepeat">
                        <tr style="display: none;" class="subRow group-#{item.decision.id}">
                            <td style="border:none;"></td>
                            <td></td>
                            <td>#{version.state.statusName}</td>
                            <td><ice:outputText value="#{version.documentedWhen}" nospan="true">
                            <f:convertDateTime type="date" pattern="#{common['format.date.time']}" timeZone="#{timeZoneController.timeZone}" />
                        </ice:outputText></td>
                        <td title="#{item.getAllInitiators(version)}" class="vtip">#{item.getInitiators(version)}</td>
                        <td> <a href="#{decisionTableController.getShowLink(version)}" ><img class="vtip" title="details" alt="#{common.read}"
                                                                                             src="resources/images/inspect.png"
                                                                                             width="14"
                                                                                             height="14"/></a></td>
                        <td><a href="#{decisionTableController.getUpdateLink(version)}" ><img class="vtip" title="edit" alt="#{common.edit}"
                                                                                              src="resources/images/pencilSmall.png"
                                                                                              width="14"
                                                                                              height="14"/></a></td>
                        <td><ice:commandLink value=""
                                             actionListener="#{decisionTableController.showDeleteVersionConfirmation}"
                                             styleClass="columnNavigationLink">
                            <img alt="#{common.remove}"
                                 src="resources/images/removeSmall.png"
                                 width="14"
                                 height="14"/>
                            <f:attribute value="#{version}" name="version" />

                        </ice:commandLink></td>
                        </tr>
                    </ui:repeat>
                </ui:repeat>
                </tbody>
            </table>
        </ice:form>
    </ui:define>
</ui:composition>